/* Unified dynamic theme + component styles */

/* Base variables (dark-first). Body theme classes override these. */
:root{
  --bg-0: #071226;
  --bg-1: linear-gradient(180deg,#0b2940 0%, #13294a 100%);
  --panel-bg: rgba(255,255,255,0.03);
  --panel-border: rgba(255,255,255,0.06);
  --accent: #9ed7ff;
  --accent-2: #cbe6ff;
  --temp-color: #ffffff;
  --muted: rgba(255,255,255,0.7);
  --card-radius: 16px;
  --glass-blur: 8px;
  --shadow-soft: 0 10px 30px rgba(0,0,0,0.45);
  --map-height: 360px;
  --transition: 240ms cubic-bezier(.2,.9,.3,1);
}

/* Light-mode fallback (prefers-color-scheme or explicit .theme-day) */
body.theme-day {
  --bg-0: #f6fbff;
  --bg-1: linear-gradient(180deg,#f4f7fa 0%, #eaf6ff 100%);
  --panel-bg: rgba(255,255,255,0.94);
  --panel-border: rgba(11,41,69,0.04);
  --accent: #ff7a00;
  --accent-2: #0066cc;
  --temp-color: #0b2945;
  --muted: #5b6b7a;
  --glass-blur: 0px;
  --shadow-soft: 0 6px 18px rgba(11,41,69,0.06);
}

@media (prefers-color-scheme: light) {
  :root {
    --bg-0: #f6fbff;
    --bg-1: linear-gradient(180deg,#f4f7fa 0%, #eaf6ff 100%);
    --panel-bg: rgba(255,255,255,0.94);
    --panel-border: rgba(11,41,69,0.04);
    --accent: #ff7a00;
    --accent-2: #0066cc;
    --temp-color: #0b2945;
    --muted: #5b6b7a;
    --glass-blur: 0px;
    --shadow-soft: 0 6px 18px rgba(11,41,69,0.06);
  }
}

/* Page base */
html,body{ height:100%; margin:0; padding:0; font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
body{ background: var(--bg-1); color: var(--temp-color); transition: background var(--transition), color var(--transition); }

/* Dynamic animated background */
@keyframes bgShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
body {
  background-size: 200% 200%;
  animation: bgShift 18s ease-in-out infinite;
}

/* App container */
.app-container{ max-width:760px; margin:20px auto; padding:18px; }

/* Header */
header{ display:flex; gap:12px; align-items:flex-start; padding:8px 0 14px 0; background:transparent; }
header h1{ margin:0; font-size:1.15rem; font-weight:600; color:var(--accent-2); }
header p{ margin:4px 0 0 0; color:var(--muted); font-size:0.9rem; }

/* Layout grid */
.dashboard-grid{ display:grid; grid-template-columns: 1fr 420px; gap:18px; align-items:start; }

/* Card common */
.grid-item{
  background: linear-gradient(180deg, var(--panel-bg), rgba(255,255,255,0.01));
  border:1px solid var(--panel-border);
  border-radius: var(--card-radius);
  padding:12px;
  box-shadow: var(--shadow-soft);
  backdrop-filter: blur(var(--glass-blur)) saturate(120%);
  transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
}

/* Weather card specifics */
.weather-card{
  max-width:720px;
  margin-left:auto;
  margin-right:auto;
}
.weather-card h2{ margin-top:0; color:var(--accent); font-weight:600; }
.temperature{ font-size:2.6rem; font-weight:700; margin:6px 0; color:var(--temp-dynamic); letter-spacing:-0.6px; }
.temperature {
  will-change: transform, color;
  transition: transform 420ms cubic-bezier(.2,.9,.3,1), color 420ms ease;
}
.temperature.temp-anim {
  transform: scale(1.08);
  text-shadow: 0 6px 18px rgba(0,0,0,0.28);
}
.condition{ color:var(--accent); margin-top:6px; font-size:1rem; }

/* Details */
.details{ margin-top:10px; display:flex; gap:12px; flex-wrap:wrap; color:var(--muted); font-size:0.95rem; }
.details span{ display:inline-block; }

/* Search & autocomplete */
.search-section{ margin-bottom:14px; position:relative; display:flex; flex-direction:column; gap:8px; }
#city-search{
  width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04);
  background: rgba(255,255,255,0.02); color:var(--temp-color); outline:none; transition: box-shadow var(--transition);
}
#city-search:focus{ box-shadow: 0 6px 20px rgba(0,0,0,0.12); }
.autocomplete-list{
  position:absolute; top:46px; left:0; right:0; z-index:25; max-height:220px; overflow:auto;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.03); border-radius:10px; padding:6px;
}
.autocomplete-list li{ padding:8px 10px; cursor:pointer; border-radius:8px; color:var(--temp-color); }
.autocomplete-list li:hover{ background: rgba(255,255,255,0.03); transform: translateY(-2px); }

/* Recent searches select */
#recent-searches{ padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background: rgba(255,255,255,0.02); color:var(--temp-color); }

/* Spinner */
.spinner{ display:inline-block; width:28px; height:28px; border-radius:50%; border:3px solid rgba(255,255,255,0.06); border-top-color:var(--accent); animation: spin 1s linear infinite; }
@keyframes spin{ to{ transform: rotate(360deg); } }

/* Forecast list: show 3 items at a time, horizontal scroll to see others */
.forecast-list{
  list-style:none;
  margin:0;
  padding:6px 0 10px 0;
  display:flex;
  gap:12px;
  overflow-x:auto; /* ensure horizontal scrolling */
  -webkit-overflow-scrolling:touch;
  scroll-snap-type: x mandatory;
  /* visible scrollbars */
  scrollbar-color: rgba(255,255,255,0.18) transparent;
  scrollbar-width: thin;
  padding-bottom: 10px;
}

/* Each item occupies roughly 1/3 of the visible area (accounting for gaps) */
.forecast-item{
  flex: 0 0 calc((100% - 24px) / 3);
  min-width: calc((100% - 24px) / 3);
  max-width: calc((100% - 24px) / 3);
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.04);
  border-radius:14px;
  padding:10px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
  text-align:center;
  box-shadow: inset 0 -8px 18px rgba(0,0,0,0.12);
  transition: transform var(--transition), background var(--transition);
  scroll-snap-align: center;
}

/* WebKit scrollbar styling (visually clear) */
.forecast-list::-webkit-scrollbar { height: 10px; }
.forecast-list::-webkit-scrollbar-track { background: transparent; }
.forecast-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.12); border-radius: 8px; }

/* Responsive: on very small screens show 2 items at a time for readability */
@media (max-width: 520px) {
  .forecast-item {
    flex: 0 0 calc((100% - 12px) / 2);
    min-width: calc((100% - 12px) / 2);
    max-width: calc((100% - 12px) / 2);
    padding:12px;
  }
}

/* Map card & controls */
.map-card{ display:flex; flex-direction:column; gap:8px; }
#map{ height: var(--map-height); border-radius:12px; overflow:hidden; margin-top:8px; transition: filter var(--transition), height var(--transition); }
#map-controls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
#weather-layer-select, #recent-searches, select{
  padding:8px 10px; border-radius:12px; border:1px solid rgba(255,255,255,0.04); background: rgba(255,255,255,0.02); color:var(--temp-color);
}
#map-refresh{
  padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,0.06);
  background: linear-gradient(90deg, rgba(158,215,255,0.08), rgba(203,230,255,0.04));
  color:var(--accent-2); cursor:pointer;
}
#map-timestamp{ color:var(--muted); padding:6px 8px; border-radius:8px; background: rgba(255,255,255,0.02); }

/* Theme toggle */
.theme-control{ margin-left:auto; }
.theme-switch{ display:inline-block; position:relative; user-select:none; cursor:pointer; }
.theme-switch input{ position:absolute; opacity:0; pointer-events:none; }
.toggle-track{
  width:54px; height:30px; border-radius:999px; display:inline-block; position:relative;
  background: linear-gradient(180deg,#e6eef8,#dbeefc); box-shadow: inset 0 3px 10px rgba(0,0,0,0.08);
}
.toggle-thumb{
  position:absolute; top:4px; left:4px; width:22px; height:22px; border-radius:50%;
  background: radial-gradient(circle at 35% 30%, #fff 0%, #ffd24a 20%, #ffb800 60%); box-shadow: 0 3px 7px rgba(0,0,0,0.18);
  transition: transform var(--transition), background var(--transition);
}
.theme-switch input:checked + .toggle-track{ background: linear-gradient(180deg,#2b3b4a,#101820); box-shadow:none; }
.theme-switch input:checked + .toggle-track .toggle-thumb{ transform: translateX(24px); background: radial-gradient(circle at 30% 30%, #f6f8ff 0%, #c8d7ef 18%, #9fb7d6 50%); box-shadow: 0 2px 6px rgba(0,0,0,0.45); }

/* Night-specific subtle adjustments using class */
body.theme-night #map{ filter: brightness(0.95) contrast(1.05); }
body.theme-night .grid-item{ box-shadow: 0 12px 36px rgba(0,0,0,0.6); }

/* Accessibility: focus states */
a:focus, button:focus, input:focus, select:focus{ outline: 3px solid rgba(158,215,255,0.18); outline-offset:2px; }

/* Scrollbars (subtle) */
.forecast-list::-webkit-scrollbar{ height:8px; }
.forecast-list::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.06); border-radius:8px; }

/* Responsive */
@media (max-width: 900px){ .dashboard-grid{ grid-template-columns: 1fr; } .map-card{ order:2; } #map{ height:300px; } .temperature{ font-size:2.2rem; } }

@media (max-width: 520px){ .toggle-track{ width:46px; height:26px; } .toggle-thumb{ width:20px; height:20px; top:3px; left:3px; } .forecast-item{ min-width:92px; max-width:96px; padding:8px; } .temperature{ font-size:1.6rem; } }

/* Fullscreen map styles */
.map-card.map-fullscreen {
  position: fixed;
  inset: 0; /* top:0; right:0; bottom:0; left:0; */
  width: 100vw;
  height: 100vh;
  margin: 0;
  border-radius: 0;
  z-index: 9999;
  padding: 18px;
  display: flex;
  flex-direction: column;
  background: linear-gradient(180deg, rgba(0,0,0,0.48), rgba(0,0,0,0.28));
  box-shadow: 0 30px 60px rgba(0,0,0,0.6);
}

.map-card.map-fullscreen #map {
  flex: 1 1 auto;
  height: auto !important;
  width: 100%;
  border-radius: 0;
}

/* Ensure controls remain visible on top of map in fullscreen */
.map-card.map-fullscreen #map-controls {
  position: absolute;
  top: 14px;
  left: 14px;
  right: auto;
  z-index: 10001;
  background: rgba(255,255,255,0.03);
  padding: 8px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.04);
  display: flex;
  gap: 8px;
  align-items: center;
}

/* Fullscreen button visual tweaks */
#map-fullscreen {
  padding: 8px 10px;
  border-radius: 10px;
  background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.04);
  color: var(--temp-color);
  cursor: pointer;
}

/* When fullscreen is active, give the button a clear close icon look */
.map-card.map-fullscreen #map-fullscreen {
  background: rgba(255,255,255,0.04);
  box-shadow: 0 6px 18px rgba(0,0,0,0.35) inset;
}

/* Small transition for smoother toggle */
.map-card, #map { transition: all 240ms cubic-bezier(.2,.9,.3,1); }

/* Pulsing custom marker (used with DivIcon) */
.pulse-marker {
  width: 22px; height: 22px; display:flex; align-items:center; justify-content:center;
  pointer-events: auto;
}
.pulse-marker .pin {
  width: 12px; height: 12px; border-radius:50%;
  background: var(--accent);
  box-shadow: 0 0 0 6px rgba(158,215,255,0.08), 0 6px 18px rgba(0,0,0,0.28);
  position:relative;
  animation: ping 1500ms infinite cubic-bezier(.2,.9,.3,1);
  border: 2px solid rgba(255,255,255,0.12);
}
@keyframes ping {
  0% { transform: scale(0.9); box-shadow: 0 0 0 0 rgba(158,215,255,0.12); }
  70% { transform: scale(1.35); box-shadow: 0 0 0 8px rgba(158,215,255,0.04); opacity: 0.6; }
  100% { transform: scale(1.5); box-shadow: 0 0 0 12px rgba(158,215,255,0.02); opacity: 0; }
}

/* Map control hover to feel active */
#map-controls button, #map-controls select {
  transition: transform 180ms ease, box-shadow 180ms ease, background 180ms ease;
}
#map-controls button:hover, #map-controls select:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.16);
}

/* Small responsive tweak for fullscreen controls */
.map-card.map-fullscreen #map-controls { gap:10px; padding:10px; }

/* Provide a CSS variable hook for JS to set temperature color dynamically */
:root { --temp-dynamic: var(--temp-color); }

/* Improved responsive rules (minimal, keeps existing colors) */
@media (max-width: 900px) {
	/* stack for tablet / small laptop */
	.dashboard-grid { grid-template-columns: 1fr; }
	.map-card { order: 2; }
	#map { height: 380px; } /* slightly larger map on tablets */
	.temperature { font-size: 3.2rem; }
	header { align-items: center; gap: 8px; flex-wrap: wrap; }
	header h1 { font-size: 1.05rem; }
	.search-section { width: 100%; }
	#city-search { padding: 12px 14px; font-size: 1rem; }
	.autocomplete-list { max-height: 260px; -webkit-overflow-scrolling: touch; }
}

@media (max-width: 520px) {
	/* phone-specific touch-friendly adjustments */
	.dashboard-grid { grid-template-columns: 1fr; padding: 12px; }
	.grid-item { padding: 12px; border-radius: 12px; }
	#map { height: 460px; } /* taller map for phones */
	.map-card.map-fullscreen #map { height: 100vh; }
	#map-controls { gap: 8px; align-items: stretch; }
	#map-controls > * { min-height: 44px; } /* touch target */
	#map-controls select, #map-controls button { font-size: 0.95rem; padding: 10px 12px; }
	#city-search { padding: 12px 14px; font-size: 1rem; }
	.autocomplete-list li { padding: 12px 14px; font-size: 1rem; }
	/* make forecast items more readable on phones */
	.forecast-item { min-width: 120px; max-width: 140px; padding: 12px; }
	.forecast-list { gap: 12px; padding-bottom: 14px; }
	/* ensure header doesn't overcrowd */
	header { padding-top: 6px; }
	header p { width: 100%; margin-top: 6px; }
	footer { padding: 12px 0; text-align: center; font-size: 0.9rem; }
}

/* Portrait: force stacked layout and put map under the weather card */
@media (orientation: portrait) {
  .dashboard-grid {
    grid-template-columns: 1fr; /* single column */
  }
  /* ensure weather card stays first and map stays after it */
  .weather-card { order: 1; }
  .map-card { order: 2; width: 100%; margin-top: 12px; }

  /* make the map taller on portrait devices (viewport-aware) */
  #map {
    height: 48vh; /* relative height so header/footer remain visible */
    min-height: 320px; /* safe minimum */
  }

  /* fullscreen controls move to bottom on portrait so they don't obstruct center */
  .map-card.map-fullscreen #map-controls {
    top: auto;
    bottom: 16px;
    left: 12px;
    right: 12px;
    justify-content: space-between;
    background: rgba(255,255,255,0.04);
  }
}

/* Strong portrait rule: ensure single-column stack and map at bottom */
@media (orientation: portrait) {
  .dashboard-grid {
    grid-template-columns: 1fr !important; /* force single column */
  }
  .weather-card { order: 1 !important; }
  .map-card { order: 2 !important; width: 100% !important; margin-top: 12px !important; }

  /* portrait map sizing (relative to viewport) */
  #map {
    height: 52vh !important;
    min-height: 320px !important;
  }

  /* fullscreen controls moved to bottom so they don't cover map center */
  .map-card.map-fullscreen #map-controls {
    top: auto !important;
    bottom: 16px !important;
    left: 12px !important;
    right: 12px !important;
    justify-content: space-between !important;
    background: rgba(255,255,255,0.04) !important;
  }
}

/* Force single-column layout everywhere so map is always below the weather info */
.dashboard-grid {
  grid-template-columns: 1fr !important;
  align-items: start !important;
  gap: 18px !important;
}

/* Ensure ordering: weather first, map second */
.weather-card { order: 1 !important; }
.map-card { order: 2 !important; width: 100% !important; }

/* Make the map visually separated under the weather content */
.grid-item.map-card { margin-top: 12px !important; }
#map { margin-top: 8px !important; width: 100% !important; }

/* Keep map controls accessible when map is below content */
.map-card.map-fullscreen #map-controls {
  top: 14px !important;
  left: 14px !important;
  right: auto !important;
  bottom: auto !important;
}